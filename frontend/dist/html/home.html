
<style>
  /* --- Estilo Base para TODOS os cards --- */
  .card {
    padding: 20px;
    border-radius: 12px;
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  /* --- Efeito de Interatividade no Hover --- */
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
  }

  /* --- Estilo para o Card em Destaque --- */
  .card-data-highlight {
    background: linear-gradient(135deg, #004d7a, #008793);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.25);
  }

  .card-data-highlight h3 {
    font-size: 1.2rem;
    font-weight: 600;
    opacity: 0.9;
  }

  /* --- Estilos para os Textos de Dados --- */
  .data-value {
    font-size: 2.2rem;
    font-weight: 700;
    line-height: 1.2; 
    margin: 8px 0;
  }

  .data-note {
    display: block;
    font-size: 0.85rem;
    opacity: 0.8;
  }

  .card-data-highlight a {
      color: white;
      text-decoration: underline;
  }
</style>

  <main>
    <section class="hero">
      <div class="hero-content">
        <h2>Democratizando dados e análises sobre segurança pública e justiça no Brasil.</h2>
        <p>O Pulso Urbano integra dados de vitimização e registros administrativos para revelar um panorama completo
          sobre a criminalidade e o acesso à justiça no país.</p>
        <a href="#paineis" class="btn-primary">Explorar os Painéis</a>
      </div>
    </section>

    <section class="featured-section" id="paineis">
      <h2 class="section-title">Painéis em Destaque</h2>
      <div class="card-container">
        <article class="card">
          <h3>Monitor do Homicídio</h3>
          <p>Análise detalhada das taxas de homicídios dolosos, perfil das vítimas e o impacto do crime organizado.</p>
          <a href="/paineis/homicidios" class="card-link">Acessar Painel</a>
        </article>

        <article class="card">
          <h3>Observatório da Violência de Gênero</h3>
          <p>Dados sobre feminicídio e violência doméstica, revelando o lar como um dos espaços mais perigosos para
            mulheres.</p>
          <a href="/paineis/violencia-genero" class="card-link">Acessar Painel</a>
        </article>

        <article class="card">
          <h3>Atlas da Vitimização</h3>
          <p>Explore dados sobre crimes reportados e não reportados à polícia, baseados em pesquisas de vitimização.</p>
          <a href="/paineis/vitimizacao" class="card-link">Acessar Painel</a>
        </article>
      </div>
    </section>

    <section class="context-section">
      <h2 class="section-title">Contexto Nacional <span class="data-source">(IBGE, 2022)</span></h2>
      <div class="card-container" id="ibge-data-container">
        <article class="card card-data-highlight">
          <h3 id="total-population-title">População Total do Brasil</h3>
          <p id="total-population-value" class="data-value">Carregando...</p>
        </article>

        <article class="card">
          <h3 id="top-state-1-name">Carregando...</h3>
          <p id="top-state-1-value" class="data-value">&nbsp;</p>
        </article>
        <article class="card">
          <h3 id="top-state-2-name">Carregando...</h3>
          <p id="top-state-2-value" class="data-value">&nbsp;</p>
        </article>
        <article class="card">
          <h3 id="top-state-3-name">Carregando...</h3>
          <p id="top-state-3-value" class="data-value">&nbsp;</p>
        </article>
      </div>
    </section>
    <section class="analysis-section">
      <h2 class="section-title">Últimas Análises</h2>
      <div class="card-container">
        <article class="card card-analysis">
          <div class="card-content">
            <span class="analysis-tag">Prospecção de Cenários</span>
            <h4>O impacto das mudanças climáticas na violência urbana</h4>
            <p>Um estudo sobre como eventos climáticos extremos podem remodelar os padrões de criminalidade nas grandes
              cidades brasileiras na próxima década.</p>
            <a href="/analises/artigo1" class="card-link">Ler mais</a>
          </div>
        </article>

        <article class="card card-analysis">
          <div class="card-content">
            <span class="analysis-tag">Sistema de Justiça</span>
            <h4>A superlotação carcerária e seus efeitos na reincidência</h4>
            <p>Uma análise baseada em dados do sistema prisional sobre a correlação entre a superlotação e as taxas de
              reincidência criminal.</p>
            <a href="/analises/artigo2" class="card-link">Ler mais</a>
          </div>
        </article>
      </div>
    </section>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    const dataContainer = document.getElementById('ibge-data-container');

    const renderErrorCard = (title) => {
      const errorCard = document.createElement('article');
      errorCard.className = 'card';
      errorCard.innerHTML = `
        <h3>${title}</h3>
        <p style="color: #c55;">Não foi possível carregar este dado.</p>
      `;
      dataContainer.appendChild(errorCard);
    };

    try {
      const anoCorrente = new Date().getFullYear();
      const anoAnterior = anoCorrente - 1;

      const promises = [
        fetch('/api/contexto/populacao'),
        fetch(`/api/contexto/gastos-seguranca?ano=${anoAnterior}`),
        fetch(`/api/contexto/legislacao-seguranca?ano=${anoAnterior}`)
      ];

      const results = await Promise.allSettled(promises);
      
      dataContainer.innerHTML = '';

      // --- Processa os resultados de População (IBGE) ---
      if (results[0].status === 'fulfilled') {
        const response = await results[0].value.json();
        const totalPopulation = response.reduce((sum, state) => sum + state.populacao, 0);
        
        const popCard = document.createElement('article');
        popCard.className = 'card card-data-highlight';
        popCard.innerHTML = `
            <h3>População Total do Brasil</h3>
            <p class="data-value">${totalPopulation.toLocaleString('pt-BR')}</p>
        `;
        dataContainer.appendChild(popCard);
      } else {
        console.error("Erro ao buscar população:", results[0].reason);
        renderErrorCard('População Total');
      }

      // --- Processa os resultados de Gastos com Segurança ---
      if (results[1].status === 'fulfilled') {
        const response = await results[1].value.json();
        
        // Verificamos se a resposta não é nula e se tem pelo menos um item.
        if (response && response.length > 0) {
          const gastoMaisRecente = response.sort((a, b) => b.ano - a.ano)[0];

          const spendingCard = document.createElement('article');
          spendingCard.className = 'card';
          spendingCard.innerHTML = `
            <h3>Gasto Federal em Segurança</h3>
            <p class="data-value">R$ ${parseFloat(gastoMaisRecente.valorBRL).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</p>
            <small class="data-note">Fonte: IPEA DATA (${gastoMaisRecente.ano})</small>
          `;
          dataContainer.appendChild(spendingCard);
        } else {
          // Se não houver dados, podemos mostrar uma mensagem ou simplesmente não renderizar o card.
          console.log("Nenhum dado de gastos com segurança encontrado para o ano.");
          const spendingCard = document.createElement('article');
          spendingCard.className = 'card';
          spendingCard.innerHTML = `
            <h3>Gasto Federal em Segurança</h3>
            <p>Dados não disponíveis para o ano.</p>
          `;
          dataContainer.appendChild(spendingCard);
        }
        // ========== FIM DA CORREÇÃO ==========

      } else {
        console.error("Erro ao buscar gastos:", results[1].reason);
        renderErrorCard('Gasto Federal');
      }

      // --- Processa os resultados de Legislação ---
      if (results[2].status === 'fulfilled') {
        const response = await results[2].value.json();
        const legislacaoRecente = response.slice(0, 2);

        const legislationCard = document.createElement('article');
        legislationCard.className = 'card card-analysis';
        legislationCard.innerHTML = `
          <h3>Propostas Legislativas (${anoAnterior})</h3>
          <ul class="legislation-list">
            ${legislacaoRecente.length > 0 ? legislacaoRecente.map(lei => `
              <li>
                <a href="${lei.link}" target="_blank" title="${lei.resumo}">
                  ${lei.sigla} ${lei.numero}/${lei.ano}
                </a>
              </li>
            `).join('') : '<li>Nenhuma proposta encontrada.</li>'}
          </ul>
        `;
        dataContainer.appendChild(legislationCard);
      } else {
        console.error("Erro ao buscar legislação:", results[2].reason);
        renderErrorCard('Propostas de Lei');
      }

    } catch (error) {
      console.error("Ocorreu um erro geral ao carregar os dados da página inicial:", error);
      dataContainer.innerHTML = `
        <article class="card error-card">
          <h3>Erro geral</h3>
          <p>Não foi possível obter as informações no momento.</p>
        </article>
      `;
    }
  });
</script>